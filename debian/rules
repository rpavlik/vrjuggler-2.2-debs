#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
#include /usr/share/cdbs/1/rules/patchsys-quilt.mk

DEB_CONFIGURE_SCRIPT := $(CURDIR)/$(DEB_SRCDIR)/configure.pl
DEB_CONFIGURE_NORMAL_ARGS := --prefix=/usr DESTDIR=$(DEB_DESTDIR)
DEB_CONFIGURE_EXTRA_FLAGS := --with-boost-includes=/usr/include --with-java-orb=JDK \
							--with-gmtl=/usr --with-openal=/usr --with-audiere=/usr

FLAGS := -Wno-deprecated
CXXFLAGS += $(FLAGS)
CFLAGS += $(FLAGS)

DEB_BUILDDIR := $(CURDIR)/debian/build/

DEB_MAKE_CLEAN_TARGET := distclean clean cleandepend clobber
DEB_MAKE_BUILD_TARGET := release prefix=$(DEB_DESTDIR)/usr  DESTDIR=$(DEB_DESTDIR)
DEB_MAKE_INSTALL_TARGET :=
DEB_MAKE_ENVVARS += VJ_BASE_DIR=$(DEB_DESTDIR) DESTDIR=$(DEB_DESTDIR)

DEB_INSTALL_DOCS_ALL := $(CURDIR)/README.txt $(CURDIR)/README.html $(CURDIR)/README-WINDOWS.html

DEB_DH_SHLIBDEPS_ARGS := -- $(patsubst %,-x%,$(DEB_ALL_PACKAGES))

makebuilddir/vrjuggler-2.2::
	./autogen.sh
	chmod a+x $(CURDIR)/debian/vrjuggler-env.sh

clean::
	# Clean up editing detritus
	-rm -f debian/*~ debian/._* .DS_Store

	# Clean up common build products
	-rm -f config.log config.status Makefile
	-rm -rf debian/build

	# Remove source build-generated files that make clean+friends misses.
	find $(CURDIR) -name aclocal.m4 | xargs rm -f
	find $(CURDIR) -name configure | xargs rm -f
	find $(CURDIR) -name *Defines.h.in | xargs rm -f

# workaround for http://bugs.debian.org/526392
#QUILT_PATCH_DIR := debian/patches
#QUILT_STAMPFN := patch
#-include /usr/share/topgit/tg2quilt.mk
